import"https://unpkg.com/@workadventure/scripting-api-extra@^1";let b,d,_,y,v,A,u,o,a,n=!1,i=!1,p=!1,l=!0;WA.onInit().then(()=>{o=WA.player.name,u=WA.player.id,WA.player.state.score=0,a=WA.player.state.score,console.log("HEEEERE "+WA.player.id)});const r=new WebSocket("wss://workadventure-ws-bs.herokuapp.com");r.onopen=function(){console.log("WebSocket opened !");const e={action:"instantiate",wa_id:WA.player.id};r.send(JSON.stringify(e))};r.onmessage=async function(e){const s=JSON.parse(e.data);if(s.action==="instantiate"&&s.success===!0){a=s.score,n=s.quest_1,i=s.quest_2,p=s.quest_3,l=s.is_registered;let m;l===!1&&(m=await WA.nav.openCoWebSite("https://nft-bs.s3.amazonaws.com/typeform.html",!0,"",50,1,!1,!1)),WA.room.onLeaveLayer("_register_form").subscribe(()=>{l===!1&&m.close()})}};r.onclose=function(){console.log("Connexion WebSocket ferm\xE9e")};WA.room.onEnterLayer("_website_perso_guillaumeM_tribune").subscribe(()=>{_=WA.ui.openPopup("messageGuillaume","Guillaume Mikowski : 'Norme ISO 20121, on nous prend vraiment pour des cons ! Je vous en parle sur Linkedin.''",[{label:"Je veux la lire",className:"primary",callback:e=>{WA.nav.openTab("https://www.linkedin.com/pulse/norme-iso-20121-nous-prend-vraiment-pour-des-cons-mikowski-/")}}])});WA.room.onLeaveLayer("_website_perso_guillaumeM_tribune").subscribe(()=>{_.close()});WA.room.onEnterLayer("_website_heroes").subscribe(()=>{v=WA.ui.openPopup("LabMessage","Bienvenue dans le lab Heroes ! Ici, on fabrique les talents pour renforcer les \xE9quipes de nos clients.",[{label:"G\xE9nial, je veux en savoir plus !",className:"primary",callback:e=>{WA.nav.openTab("https://heroes.brainsonic.com/")}}])});WA.room.onLeaveLayer("_website_heroes").subscribe(()=>{v.close()});WA.room.onEnterLayer("_website_cyril").subscribe(()=>{A=WA.ui.openPopup("msgCyril","Salut, c'est Cyril. Ici, je vous propose une s\xE9lection des meilleurs livres consacr\xE9s au marketing. Revenez r\xE9guli\xE8rement, on met \xE0 jour toutes les semaines !",[{label:"Carr\xE9ment !",className:"primary",callback:e=>{WA.nav.openTab("https://cdhenin.notion.site/Livres-La-s-lection-du-p-le-Editorial-0b58151e539a4895936e62d3aabc2b7d")}}])});WA.room.onLeaveLayer("_website_cyril").subscribe(()=>{A.close()});WA.room.onEnterLayer("_website_perso_flav").subscribe(()=>{y=WA.ui.openPopup("messageFlavien","Flavien Lefort : Ev\xE9nement digital, ce que 20 ans (ou presque) nous ont appris - \xE0 lire sur Linkedin",[{label:"Je veux la lire",className:"primary",callback:e=>{WA.nav.openTab("https://www.linkedin.com/pulse/ev%C3%A9nement-digital-ce-que-20-ans-ou-presque-nous-ont-appris-lefort/?originalSubdomain=fr")}}])});WA.room.onLeaveLayer("_website_perso_flav").subscribe(()=>{y.close()});WA.room.onEnterLayer("_prompt_escaliers").subscribe(()=>{b=WA.ui.openPopup("promptEscaliers","Toutes nos excuses, le 1er \xE9tage est en travaux ! Revenez un peu plus tard.",[{label:"Tant pis",className:"primary",callback:e=>{e.close()}}])});WA.room.onLeaveLayer("_prompt_escaliers").subscribe(()=>{b.close()});WA.room.onEnterLayer("_prompt_welcome").subscribe(()=>{d=WA.ui.openPopup("promptWelcome","Bonjour "+o+", et bienvenue chez Brainsonic ! RDV \xE0 notre accueil pour obtenir quelques conseils pratiques !",[{label:"J'ai compris !",className:"primary",callback:e=>{e.close()}}])});WA.room.onLeaveLayer("_prompt_welcome").subscribe(()=>{d.close()});let W;WA.room.onEnterLayer("_quete_begin").subscribe(()=>{n||(W=WA.ui.openPopup("queteBegin","Aventurier "+o+", BrainsoMinion s'est cach\xE9 quelque part dans l'agence, retrouve le pour remporter des BrainsoPoints !",[{label:"Compris !",className:"primary",callback:e=>{e.close()}}]))});WA.room.onLeaveLayer("_quete_begin").subscribe(()=>{n||W.close()});let t;WA.room.onEnterLayer("_brainso_minion").subscribe(()=>{if(n)i?t=WA.ui.openPopup("brainsoMinion",o+`, n'essaye pas de gratter des BrainsoPoints, tu as d\xE9j\xE0 trouv\xE9 BrainsoMinion...
 Il te reste un dernier personnage \xE0 d\xE9couvrir...`,[{label:"Bon ok !",className:"primary",callback:e=>{e.close()}}]):t=WA.ui.openPopup("brainsoMinion",o+`, n'essaye pas de gratter des BrainsoPoints, tu as d\xE9j\xE0 trouv\xE9 BrainsoMinion...
 Il te reste toujours un personnage \xE0 trouver en dehors de l'agence !`,[{label:"Bon ok !",className:"primary",callback:e=>{e.close()}}]);else{a+=5,n=!0;let e={action:"update_score",wa_id:WA.player.id,new_score:a};r.send(JSON.stringify(e)),t=WA.ui.openPopup("brainsoMinion","Bien jou\xE9 "+o+`, tu viens de remporter 5 BrainsoPoints !
 Tu as maintenant `+a+` BrainsoPoints !
 Un autre personnage t'attends en dehors de l'agence...`,[{label:"Super !",className:"primary",callback:s=>{s.close()}}]),e={action:"update_quest",wa_id:WA.player.id,quest_nbr:1},r.send(JSON.stringify(e))}});WA.room.onLeaveLayer("_brainso_minion").subscribe(()=>{t.close()});let c;WA.room.onEnterLayer("_brainso_batman").subscribe(()=>{if(n&&!i){a+=10,i=!0;let e={action:"update_score",wa_id:WA.player.id,new_score:a};r.send(JSON.stringify(e)),c=WA.ui.openPopup("Batman","Bien jou\xE9 "+o+`, tu viens de remporter 10 BrainsoPoints !
 Tu as maintenant `+a+` BrainsoPoints !
 Il te reste un dernier personnage \xE0 d\xE9couvrir...`,[{label:"Super !",className:"primary",callback:s=>{s.close()}}]),e={action:"update_quest",wa_id:WA.player.id,quest_nbr:2},r.send(JSON.stringify(e))}else c=WA.ui.openPopup("Batman",o+`, n'essaye pas de gratter des BrainsoPoints, tu as d\xE9j\xE0 trouv\xE9 BrainsoBatman...
 Il te reste toujours un dernier personnage \xE0 trouver !`,[{label:"Bon ok !",className:"primary",callback:e=>{e.close()}}])});WA.room.onLeaveLayer("_brainso_batman").subscribe(()=>{c.close()});let g;WA.room.onEnterLayer("_action_guybrush").subscribe(async()=>{n&&i&&!p&&(console.log("https://chat.csml.dev/s/qv7m5yuob8wnf5inguwt0vfvy0spmsqx?metadata=%7B%22waid%22%3A%22"+u+"%22%2C%22pseudo%22%3A%22"+o+"%22%2C%22score%22%3A%22"+a+"%22%7D"),g=await WA.nav.openCoWebSite("https://chat.csml.dev/s/qv7m5yuob8wnf5inguwt0vfvy0spmsqx?metadata=%7B%22waid%22%3A%22"+u+"%22%2C%22pseudo%22%3A%22"+o+"%22%2C%22score%22%3A%22"+a+"%22%7D",!0,"",50,1,!1,!1))});WA.room.onLeaveLayer("_action_guybrush").subscribe(()=>{p||g.close()});
